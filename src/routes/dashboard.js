import { Router } from 'express';import { connectDB, collections } from '../db.js';const router=Router();router.get('/performance',async(req,res)=>{try{const db=await connectDB();const{metrics}=collections(db);const[perf]=await metrics.aggregate([{ $match:{type:'perf'}},{ $sort:{createdAt:-1}},{ $limit:1}]).toArray();res.json(perf||{apiLatencyMs:120,sseConnections:1,failedRequests:0,createdAt:new Date()});}catch(e){res.status(500).json({error:'server_error',details:e.message});}});router.get('/assistant-stats',async(req,res)=>{try{const db=await connectDB();const{metrics}=collections(db);const stats=await metrics.aggregate([{ $match:{type:'assistant'}},{ $group:{ _id:null,totalQueries:{ $sum:'$count'},avgLatencyMs:{ $avg:'$latencyMs'},intents:{ $push:'$intents'},functions:{ $push:'$functions'}}}]).toArray();res.json(stats[0]||{ totalQueries:0,avgLatencyMs:0,intents:[],functions:[]});}catch(e){res.status(500).json({error:'server_error',details:e.message});}});export default router;