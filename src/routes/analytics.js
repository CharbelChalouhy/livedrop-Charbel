import { Router } from 'express';import { connectDB, collections } from '../db.js';const router=Router();router.get('/dashboard-metrics',async(req,res)=>{try{const db=await connectDB();const{orders}=collections(db);const[summary]=await orders.aggregate([{ $group:{ _id:null,totalRevenue:{ $sum:'$total'},totalOrders:{ $count:{}},avgOrderValue:{ $avg:'$total'}}}]).toArray();const byStatus=await orders.aggregate([{ $group:{ _id:'$status',count:{ $count:{}}}},{ $project:{ _id:0,status:'$_id',count:1}}]).toArray();res.json({ totalRevenue:summary?.totalRevenue||0,totalOrders:summary?.totalOrders||0,avgOrderValue:summary?.avgOrderValue||0,ordersByStatus:byStatus});}catch(e){res.status(500).json({error:'server_error',details:e.message});}});export default router;