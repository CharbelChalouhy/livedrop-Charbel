import { Router } from 'express';import { connectDB, collections } from '../db.js';const router=Router();router.post('/',async(req,res)=>{try{const{customerId,items=[]}=req.body||{};if(!customerId||!Array.isArray(items)||items.length===0)return res.status(400).json({error:'invalid_payload'});const db=await connectDB();const{orders}=collections(db);const total=items.reduce((s,it)=>s+it.price*it.quantity,0);const doc={_id:crypto.randomUUID(),customerId,items,total,status:'PENDING',carrier:'FastShip',estimatedDelivery:new Date(Date.now()+5*86400000),createdAt:new Date(),updatedAt:new Date()};await orders.insertOne(doc);res.status(201).json(doc);}catch(e){res.status(500).json({error:'server_error',details:e.message});}});router.get('/',async(req,res)=>{try{const db=await connectDB();const{orders}=collections(db);const list=await orders.find({}).sort({createdAt:-1}).toArray();res.json(list);}catch(e){res.status(500).json({error:'server_error',details:e.message});}});export default router;