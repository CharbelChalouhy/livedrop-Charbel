import { Router } from 'express';import { connectDB, collections } from '../db.js';const router=Router();router.get('/',async(req,res)=>{try{const{search='',tag,sort='relevance',page=1,limit=12}=req.query;const db=await connectDB();const{products}=collections(db);const q=[];if(search)q.push({name:{$regex:search,$options:'i'}});if(tag)q.push({tags:tag});const filter=q.length?{$and:q}:{},sortMap={relevance:{createdAt:-1},price_asc:{price:1},price_desc:{price:-1}};const data=await products.find(filter).sort(sortMap[sort]||sortMap.relevance).skip((+page-1)*+limit).limit(+limit).toArray();res.json(data);}catch(e){res.status(500).json({error:'server_error',details:e.message});}});export default router;